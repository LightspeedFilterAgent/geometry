<!DOCTYPE html>
<html>
<head>
  <title>Settings</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
    }
  
    .container {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
  
    h1 {
      text-align: center;
      color: #333;
    }
  
    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
    }
  
    select,
    input[type="time"],
    input[type="text"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
  
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
  
    th,
    td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
  
    th {
      background-color: #f2f2f2;
    }
  
    button {
      padding: 8px 12px;
      background-color: #4caf50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  
    button:hover {
      background-color: #45a049;
    }
  </style>
  
</head>
<body>

<div class="container">
  <h1>Settings</h1>
  <label for="background">Funni Cursor Effects</label>
  <select id="background" onchange="saveSettings()">
    <option value="true">Yes</option>
    <option value="false">Hell no</option>
  </select>
  <br>
  <label for="proxy">Proxy</label>
  <select id="proxy" onchange="saveSettings()">
    <option value="none">Clo@k3r</option>
    <option value="interstellar">Interstellar</option>
    <option value="astroid">Astroid</option>
</select>
<br>
<!--
<label for="Periods">what is your schedule?</label>
<select id="Periods" onchange="toggleScheduleSettings()">
<option value="noschool">No School!</option>
<option value="advisory">Advisory</option>
<option value="normal">Normal</option>
</select>
<div id="scheduleSettings" style="display: none;">
  <table id="scheduleTable">
    <tr>
      <th>Start of class</th>
      <th>End of class</th>
      <th>Panic Link</th>
      <th> </th>

    </tr>
  </table>
  <button onclick="addScheduleRow()">Add Row</button>
</div>
!-->
</div>
<script>
  function toggleScheduleSettings() {
    const selectedOption = document.getElementById("Periods").value;
    const scheduleSettings = document.getElementById("scheduleSettings");
    const savedSchedule = localStorage.getItem(selectedOption);

    if (selectedOption === "advisory" || selectedOption === "normal") {
      scheduleSettings.style.display = "block";
      loadSavedSettings(selectedOption, savedSchedule);
    } else {
      scheduleSettings.style.display = "none";
    }
  }

  function addScheduleRow() {
    const table = document.getElementById("scheduleTable");
    const rowCount = table.rows.length;

    const row = table.insertRow(rowCount);
    const cell1 = row.insertCell(0);
    const cell2 = row.insertCell(1);
    const cell3 = row.insertCell(2);
    const cell4 = row.insertCell(3);

    cell1.innerHTML = `<input type="time" id="fromTime${rowCount}" onchange="saveSettings()">`;
    cell2.innerHTML = `<input type="time" id="toTime${rowCount}" onchange="saveSettings()">`;
    cell3.innerHTML = `<input type="text" id="link${rowCount}" onchange="saveSettings()">`;
    cell4.innerHTML = `<button onclick="deleteRow(${rowCount})">Delete Row</button>`;

    saveSettings();
  }

  function saveSettings() {
    const selectedOption = document.getElementById("Periods").value;
    const table = document.getElementById("scheduleTable");
  localStorage.setItem("selectedSchedule", selectedOption);
    const scheduleData = [];

    for (let i = 1; i < table.rows.length; i++) {
      const fromTime = document.getElementById(`fromTime${i}`).value;
      const toTime = document.getElementById(`toTime${i}`).value;
      const link = document.getElementById(`link${i}`).value;

      scheduleData.push({ fromTime, toTime, link });
    }

    localStorage.setItem(selectedOption, JSON.stringify(scheduleData));
  }

  function loadSavedSettings(selectedOption, savedSchedule) {
    const table = document.getElementById("scheduleTable");
    table.innerHTML = `<tr><th>Start</th><th>End</th><th>Panic Link</th><th></th></tr>`;

    if (savedSchedule) {
      const scheduleData = JSON.parse(savedSchedule);

      scheduleData.forEach((data) => {
        const rowCount = table.rows.length;
        const row = table.insertRow(rowCount);
        const cell1 = row.insertCell(0);
        const cell2 = row.insertCell(1);
        const cell3 = row.insertCell(2);
        const cell4 = row.insertCell(3);

        cell1.innerHTML = `<input type="time" id="fromTime${rowCount}" value="${data.fromTime}" onchange="saveSettings()">`;
        cell2.innerHTML = `<input type="time" id="toTime${rowCount}" value="${data.toTime}" onchange="saveSettings()">`;
        cell3.innerHTML = `<input type="text" id="link${rowCount}" value="${data.link}" onchange="saveSettings()">`;
        cell4.innerHTML = `<button onclick="deleteRow(${rowCount})">Delete Row</button>`;
      });
    }
  }

  function deleteRow(rowNumber) {
    const table = document.getElementById("scheduleTable");
    if (table.rows.length > 2) {
      table.deleteRow(rowNumber);
      saveSettings();
    }
  }

  // Load saved settings on page load if applicable
  const selectedOption = document.getElementById("Periods").value;
  const savedSchedule = localStorage.getItem(selectedOption);
  if (selectedOption === "advisory" || selectedOption === "normal") {
    loadSavedSettings(selectedOption, savedSchedule);
  }

// Function to check and open the current schedule link
function checkAndOpenScheduleLink() {
  const now = new Date();
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();
  const selectedOption = localStorage.getItem("selectedSchedule");
  const savedSchedule = localStorage.getItem(selectedOption);

  if (savedSchedule) {
    const scheduleData = JSON.parse(savedSchedule);

    for (const period of scheduleData) {
      const startTime = period.fromTime.split(":");
      const endTime = period.toTime.split(":");
      const startHour = parseInt(startTime[0]);
      const startMinute = parseInt(startTime[1]);
      const endHour = parseInt(endTime[0]);
      const endMinute = parseInt(endTime[1]);

      if (
        (currentHour > startHour || (currentHour === startHour && currentMinute >= startMinute)) &&
        (currentHour < endHour || (currentHour === endHour && currentMinute <= endMinute))
      ) {
        const link = period.link;
        window.open(link);
        break;
      }
    }
  }
}

window.onload = function() {
  const selectedOption = localStorage.getItem("selectedSchedule");

  if (selectedOption === "advisory" || selectedOption === "normal") {
    loadSavedSettings(selectedOption, localStorage.getItem(selectedOption));
    checkAndOpenScheduleLink(); // Check and open schedule link after loading saved settings
  }

  const savedBackground = localStorage.getItem("userBackground");
  const proxy = localStorage.getItem("proxy");

  if (savedBackground) {
    document.getElementById("background").value = savedBackground;
  }
  if (proxy) {
    document.getElementById("proxy").value = proxy;
  }
};

  if (selectedOption === "advisory" || selectedOption === "normal") {
    loadSavedSettings(selectedOption, savedSchedule);
  }
  if (savedSchedule) {
    const scheduleData = JSON.parse(savedSchedule);

    for (const period of scheduleData) {
      const startTime = period.fromTime.split(":");
      const endTime = period.toTime.split(":");

      const startHour = parseInt(startTime[0]);
      const startMinute = parseInt(startTime[1]);
      const endHour = parseInt(endTime[0]);
      const endMinute = parseInt(endTime[1]);

      if (
        (currentHour > startHour || (currentHour === startHour && currentMinute >= startMinute)) &&
        (currentHour < endHour || (currentHour === endHour && currentMinute <= endMinute))
      ) {
        const link = period.link;
        window.open(link);
        break;
      }
    }
  }
  // Get the current time
const now = new Date();
const currentHour = now.getHours();
const currentMinute = now.getMinutes();
if (savedSchedule) {
  const scheduleData = JSON.parse(savedSchedule);

  // Iterate through the schedule data to find the matching class period
  for (const period of scheduleData) {
    const startTime = period.fromTime.split(":");
    const endTime = period.toTime.split(":");

    const startHour = parseInt(startTime[0]);
    const startMinute = parseInt(startTime[1]);
    const endHour = parseInt(endTime[0]);
    const endMinute = parseInt(endTime[1]);

    // Check if the current time is within this class period
    if (
      (currentHour > startHour || (currentHour === startHour && currentMinute >= startMinute)) &&
      (currentHour < endHour || (currentHour === endHour && currentMinute <= endMinute))
    ) {
      // Open the associated link for the current class period
      const link = period.link;
      window.open(link);
      break; // Exit the loop once a matching period is found
    }
  }
}

</script>

</body>
</html>
